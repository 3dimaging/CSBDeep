# -*- coding: utf-8 -*-
from __future__ import print_function, unicode_literals, absolute_import, division
import numpy as np
from tifffile import imsave
import warnings

from ..utils import axes_check_and_normalize, move_image_axes



def save_tiff_imagej_compatible(file, img, axes, **imsave_kwargs):
    """Save tiff in ImageJ-compatible format."""
    axes = axes_check_and_normalize(axes,img.ndim,disallowed='S')

    # convert to imagej-compatible data type
    t = img.dtype
    if   'float' in t.name: t_new = np.float32
    elif 'uint'  in t.name: t_new = np.uint16 if t.itemsize >= 2 else np.uint8
    elif 'int'   in t.name: t_new = np.int16
    else:                   t_new = t
    img = img.astype(t_new, copy=False)
    if t != t_new:
        warnings.warn("Converting data type from '%s' to ImageJ-compatible '%s'." % (t, np.dtype(t_new)))

    # move axes to correct positions for imagej
    img = move_image_axes(img, axes, 'TZCYX', True)

    imsave_kwargs['imagej'] = True
    imsave(file, img, **imsave_kwargs)
